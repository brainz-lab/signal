#!/usr/bin/env bash
set -e

echo "=== Signal Test Suite Setup ==="
echo ""

# Check if we're in the right directory
if [ ! -f "Gemfile" ]; then
  echo "Error: Please run this script from the Signal project root directory"
  exit 1
fi

echo "Step 1: Installing test dependencies..."
bundle install

echo ""
echo "Step 2: Setting up test database..."
RAILS_ENV=test bundle exec rails db:drop db:create db:schema:load 2>/dev/null || \
RAILS_ENV=test bundle exec rails db:create db:schema:load

echo ""
echo "Step 3: Running tests to verify setup..."
bundle exec rspec --format documentation --fail-fast

echo ""
echo "=== Setup Complete! ==="
echo ""
echo "Run tests with: bundle exec rspec"
echo "Run specific file: bundle exec rspec spec/models/alert_spec.rb"
echo "Run with documentation: bundle exec rspec --format documentation"
