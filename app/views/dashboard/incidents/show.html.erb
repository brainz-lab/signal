<div class="space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <div class="flex items-center gap-2 mb-1">
        <%= link_to "Incidents", dashboard_project_incidents_path(@project), class: "text-[13px] dm-text-muted" %>
        <span class="dm-text-muted">/</span>
      </div>
      <h1 class="text-[24px] font-semibold dm-text"><%= @incident.title %></h1>
    </div>

    <div class="flex items-center gap-2">
      <% if @incident.status == 'triggered' %>
        <%= button_to "Acknowledge", acknowledge_dashboard_project_incident_path(@project, @incident), method: :post, class: "px-4 py-2 text-[13px] font-medium rounded-lg cursor-pointer transition-colors dm-btn-secondary" %>
      <% end %>
      <% if @incident.status != 'resolved' %>
        <%= button_to "Resolve", resolve_dashboard_project_incident_path(@project, @incident), method: :post, class: "px-4 py-2 text-[13px] font-medium rounded-lg cursor-pointer transition-colors bg-success text-white" %>
      <% end %>
    </div>
  </div>

  <!-- Status -->
  <div class="flex items-center gap-4">
    <% case @incident.status %>
    <% when 'triggered' %>
      <span class="flex items-center gap-2 px-3 py-1.5 rounded-full dm-badge-error">
        <span class="w-2 h-2 rounded-full animate-pulse" style="background: var(--color-error-dot);"></span>
        <span class="text-[13px] font-medium">Triggered</span>
      </span>
    <% when 'acknowledged' %>
      <span class="flex items-center gap-2 px-3 py-1.5 rounded-full dm-badge-warning">
        <span class="w-2 h-2 rounded-full" style="background: var(--color-warning-orange-border);"></span>
        <span class="text-[13px] font-medium">Acknowledged</span>
      </span>
    <% else %>
      <span class="flex items-center gap-2 px-3 py-1.5 rounded-full dm-badge-success">
        <span class="w-2 h-2 rounded-full" style="background: var(--color-success-dot);"></span>
        <span class="text-[13px] font-medium">Resolved</span>
      </span>
    <% end %>

    <% case @incident.severity %>
    <% when 'critical' %>
      <span class="px-3 py-1.5 text-[13px] font-medium rounded-full dm-badge-error">Critical</span>
    <% when 'warning' %>
      <span class="px-3 py-1.5 text-[13px] font-medium rounded-full dm-badge-warning">Warning</span>
    <% else %>
      <span class="px-3 py-1.5 text-[13px] font-medium rounded-full dm-badge-info">Info</span>
    <% end %>
  </div>

  <!-- Details -->
  <div class="grid grid-cols-2 gap-6">
    <div class="rounded-xl px-5 py-4 dm-card">
      <h3 class="text-[13px] font-medium mb-3 dm-text-muted">Incident Details</h3>
      <dl class="space-y-2">
        <div class="flex justify-between">
          <dt class="text-[13px] dm-text-placeholder">Triggered</dt>
          <dd class="text-[13px] font-medium dm-text"><%= @incident.triggered_at&.strftime('%Y-%m-%d %H:%M:%S') %></dd>
        </div>
        <% if @incident.acknowledged_at %>
          <div class="flex justify-between">
            <dt class="text-[13px] dm-text-placeholder">Acknowledged</dt>
            <dd class="text-[13px] font-medium dm-text"><%= @incident.acknowledged_at.strftime('%Y-%m-%d %H:%M:%S') %></dd>
          </div>
          <div class="flex justify-between">
            <dt class="text-[13px] dm-text-placeholder">Acknowledged By</dt>
            <dd class="text-[13px] font-medium dm-text"><%= @incident.acknowledged_by %></dd>
          </div>
        <% end %>
        <% if @incident.resolved_at %>
          <div class="flex justify-between">
            <dt class="text-[13px] dm-text-placeholder">Resolved</dt>
            <dd class="text-[13px] font-medium dm-text"><%= @incident.resolved_at.strftime('%Y-%m-%d %H:%M:%S') %></dd>
          </div>
          <div class="flex justify-between">
            <dt class="text-[13px] dm-text-placeholder">Resolved By</dt>
            <dd class="text-[13px] font-medium dm-text"><%= @incident.resolved_by %></dd>
          </div>
        <% end %>
        <div class="flex justify-between">
          <dt class="text-[13px] dm-text-placeholder">Alerts</dt>
          <dd class="text-[13px] font-medium dm-text"><%= @incident.alerts.count %></dd>
        </div>
      </dl>
    </div>

    <div class="rounded-xl px-5 py-4 dm-card">
      <h3 class="text-[13px] font-medium mb-3 dm-text-muted">Affected Services</h3>
      <% if @incident.affected_services.present? %>
        <div class="flex flex-wrap gap-2">
          <% @incident.affected_services.each do |service| %>
            <span class="px-2 py-1 text-[12px] rounded" style="background: var(--color-border-light); color: var(--color-text-subtle);">
              <%= service %>
            </span>
          <% end %>
        </div>
      <% else %>
        <p class="text-[13px] dm-text-muted">No services tagged</p>
      <% end %>
    </div>
  </div>

  <!-- Resolution note -->
  <% if @incident.resolution_note.present? %>
    <div class="rounded-xl px-5 py-4 dm-card">
      <h3 class="text-[13px] font-medium mb-2 dm-text-muted">Resolution Note</h3>
      <p class="text-[14px] dm-text"><%= @incident.resolution_note %></p>
    </div>
  <% end %>

  <!-- Related Alerts -->
  <div class="rounded-xl overflow-hidden dm-card">
    <div class="px-5 py-3 border-b dm-border-light">
      <h3 class="text-[13px] font-medium dm-text-muted">Related Alerts</h3>
    </div>
    <% @incident.alerts.each_with_index do |alert, index| %>
      <%= link_to dashboard_project_alert_path(@project, alert), class: "block px-5 py-3 transition-colors hover:bg-surface-hover #{index > 0 ? 'border-t dm-border-light' : ''}" do %>
        <div class="flex items-center gap-3">
          <% case alert.state %>
          <% when 'firing' %>
            <span class="w-2 h-2 rounded-full" style="background: var(--color-error-dot);"></span>
          <% when 'pending' %>
            <span class="w-2 h-2 rounded-full" style="background: var(--color-warning-orange-border);"></span>
          <% else %>
            <span class="w-2 h-2 rounded-full" style="background: var(--color-success-dot);"></span>
          <% end %>
          <span class="text-[13px] dm-text"><%= alert.alert_rule&.name || 'Unknown' %></span>
          <span class="text-[12px] dm-text-muted">Value: <%= alert.current_value %></span>
        </div>
      <% end %>
    <% end %>
  </div>

  <!-- Timeline -->
  <% if @incident.timeline.present? %>
    <div class="rounded-xl px-5 py-4 dm-card">
      <h3 class="text-[13px] font-medium mb-4 dm-text-muted">Timeline</h3>
      <div class="space-y-3">
        <% @incident.timeline.each do |event| %>
          <div class="flex items-start gap-3">
            <span class="w-2 h-2 rounded-full mt-1.5" style="background: var(--color-icon-muted);"></span>
            <div>
              <p class="text-[13px] dm-text"><%= event['message'] %></p>
              <p class="text-[12px] dm-text-muted"><%= Time.parse(event['timestamp']).strftime('%Y-%m-%d %H:%M:%S') rescue event['timestamp'] %></p>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
