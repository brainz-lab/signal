<div class="space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <div class="flex items-center gap-2 mb-1">
        <%= link_to "Incidents", dashboard_project_incidents_path(@project), class: "text-[13px]", style: "color: #8B8780;" %>
        <span style="color: #C4C0B8;">/</span>
      </div>
      <h1 class="text-[24px] font-semibold" style="color: #1A1A1A;"><%= @incident.title %></h1>
    </div>

    <div class="flex items-center gap-2">
      <% if @incident.status == 'triggered' %>
        <%= button_to "Acknowledge", acknowledge_dashboard_project_incident_path(@project, @incident), method: :post, class: "px-4 py-2 text-[13px] font-medium rounded-lg cursor-pointer transition-colors", style: "background: #F0EFED; color: #6B6760;" %>
      <% end %>
      <% if @incident.status != 'resolved' %>
        <%= button_to "Resolve", resolve_dashboard_project_incident_path(@project, @incident), method: :post, class: "px-4 py-2 text-[13px] font-medium rounded-lg cursor-pointer transition-colors", style: "background: #16A34A; color: #FFFFFE;" %>
      <% end %>
    </div>
  </div>

  <!-- Status -->
  <div class="flex items-center gap-4">
    <% case @incident.status %>
    <% when 'triggered' %>
      <span class="flex items-center gap-2 px-3 py-1.5 rounded-full" style="background: #FEE2E2; color: #991B1B;">
        <span class="w-2 h-2 rounded-full animate-pulse" style="background: #DC2626;"></span>
        <span class="text-[13px] font-medium">Triggered</span>
      </span>
    <% when 'acknowledged' %>
      <span class="flex items-center gap-2 px-3 py-1.5 rounded-full" style="background: #FEF3C7; color: #92400E;">
        <span class="w-2 h-2 rounded-full" style="background: #F97316;"></span>
        <span class="text-[13px] font-medium">Acknowledged</span>
      </span>
    <% else %>
      <span class="flex items-center gap-2 px-3 py-1.5 rounded-full" style="background: #DCFCE7; color: #166534;">
        <span class="w-2 h-2 rounded-full" style="background: #16A34A;"></span>
        <span class="text-[13px] font-medium">Resolved</span>
      </span>
    <% end %>

    <% case @incident.severity %>
    <% when 'critical' %>
      <span class="px-3 py-1.5 text-[13px] font-medium rounded-full" style="background: #FEE2E2; color: #991B1B;">Critical</span>
    <% when 'warning' %>
      <span class="px-3 py-1.5 text-[13px] font-medium rounded-full" style="background: #FEF3C7; color: #92400E;">Warning</span>
    <% else %>
      <span class="px-3 py-1.5 text-[13px] font-medium rounded-full" style="background: #E0E7FF; color: #3730A3;">Info</span>
    <% end %>
  </div>

  <!-- Details -->
  <div class="grid grid-cols-2 gap-6">
    <div class="rounded-xl px-5 py-4" style="border: 1px solid #E8E5E0; background: #FFFFFE;">
      <h3 class="text-[13px] font-medium mb-3" style="color: #8B8780;">Incident Details</h3>
      <dl class="space-y-2">
        <div class="flex justify-between">
          <dt class="text-[13px]" style="color: #6B6760;">Triggered</dt>
          <dd class="text-[13px] font-medium" style="color: #1A1A1A;"><%= @incident.triggered_at&.strftime('%Y-%m-%d %H:%M:%S') %></dd>
        </div>
        <% if @incident.acknowledged_at %>
          <div class="flex justify-between">
            <dt class="text-[13px]" style="color: #6B6760;">Acknowledged</dt>
            <dd class="text-[13px] font-medium" style="color: #1A1A1A;"><%= @incident.acknowledged_at.strftime('%Y-%m-%d %H:%M:%S') %></dd>
          </div>
          <div class="flex justify-between">
            <dt class="text-[13px]" style="color: #6B6760;">Acknowledged By</dt>
            <dd class="text-[13px] font-medium" style="color: #1A1A1A;"><%= @incident.acknowledged_by %></dd>
          </div>
        <% end %>
        <% if @incident.resolved_at %>
          <div class="flex justify-between">
            <dt class="text-[13px]" style="color: #6B6760;">Resolved</dt>
            <dd class="text-[13px] font-medium" style="color: #1A1A1A;"><%= @incident.resolved_at.strftime('%Y-%m-%d %H:%M:%S') %></dd>
          </div>
          <div class="flex justify-between">
            <dt class="text-[13px]" style="color: #6B6760;">Resolved By</dt>
            <dd class="text-[13px] font-medium" style="color: #1A1A1A;"><%= @incident.resolved_by %></dd>
          </div>
        <% end %>
        <div class="flex justify-between">
          <dt class="text-[13px]" style="color: #6B6760;">Alerts</dt>
          <dd class="text-[13px] font-medium" style="color: #1A1A1A;"><%= @incident.alerts.count %></dd>
        </div>
      </dl>
    </div>

    <div class="rounded-xl px-5 py-4" style="border: 1px solid #E8E5E0; background: #FFFFFE;">
      <h3 class="text-[13px] font-medium mb-3" style="color: #8B8780;">Affected Services</h3>
      <% if @incident.affected_services.present? %>
        <div class="flex flex-wrap gap-2">
          <% @incident.affected_services.each do |service| %>
            <span class="px-2 py-1 text-[12px] rounded" style="background: #F0EFED; color: #6B6760;">
              <%= service %>
            </span>
          <% end %>
        </div>
      <% else %>
        <p class="text-[13px]" style="color: #8B8780;">No services tagged</p>
      <% end %>
    </div>
  </div>

  <!-- Resolution note -->
  <% if @incident.resolution_note.present? %>
    <div class="rounded-xl px-5 py-4" style="border: 1px solid #E8E5E0; background: #FFFFFE;">
      <h3 class="text-[13px] font-medium mb-2" style="color: #8B8780;">Resolution Note</h3>
      <p class="text-[14px]" style="color: #1A1A1A;"><%= @incident.resolution_note %></p>
    </div>
  <% end %>

  <!-- Related Alerts -->
  <div class="rounded-xl overflow-hidden" style="border: 1px solid #E8E5E0; background: #FFFFFE;">
    <div class="px-5 py-3" style="border-bottom: 1px solid #F0EFED;">
      <h3 class="text-[13px] font-medium" style="color: #8B8780;">Related Alerts</h3>
    </div>
    <% @incident.alerts.each_with_index do |alert, index| %>
      <%= link_to dashboard_project_alert_path(@project, alert), class: "block px-5 py-3 transition-colors hover:bg-gray-50", style: index > 0 ? "border-top: 1px solid #F0EFED;" : "" do %>
        <div class="flex items-center gap-3">
          <% case alert.state %>
          <% when 'firing' %>
            <span class="w-2 h-2 rounded-full" style="background: #DC2626;"></span>
          <% when 'pending' %>
            <span class="w-2 h-2 rounded-full" style="background: #F97316;"></span>
          <% else %>
            <span class="w-2 h-2 rounded-full" style="background: #16A34A;"></span>
          <% end %>
          <span class="text-[13px]" style="color: #1A1A1A;"><%= alert.alert_rule&.name || 'Unknown' %></span>
          <span class="text-[12px]" style="color: #8B8780;">Value: <%= alert.current_value %></span>
        </div>
      <% end %>
    <% end %>
  </div>

  <!-- Timeline -->
  <% if @incident.timeline.present? %>
    <div class="rounded-xl px-5 py-4" style="border: 1px solid #E8E5E0; background: #FFFFFE;">
      <h3 class="text-[13px] font-medium mb-4" style="color: #8B8780;">Timeline</h3>
      <div class="space-y-3">
        <% @incident.timeline.each do |event| %>
          <div class="flex items-start gap-3">
            <span class="w-2 h-2 rounded-full mt-1.5" style="background: #C4C0B8;"></span>
            <div>
              <p class="text-[13px]" style="color: #1A1A1A;"><%= event['message'] %></p>
              <p class="text-[12px]" style="color: #8B8780;"><%= Time.parse(event['timestamp']).strftime('%Y-%m-%d %H:%M:%S') rescue event['timestamp'] %></p>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
